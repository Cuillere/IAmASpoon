var Body = require('physics/body');

var Projectile = function Projectile (src, dest, player) {
    this.id = 'bullet'+Date.now();
    var forceX = dest.x - src.x;
    var forceY = dest.y - src.y;
    var max = Math.abs(forceX) + Math.abs(forceY);
    var ratioX = Math.abs(forceX)/max;
    var ratioY = Math.abs(forceY)/max;
    var xSpeed = 25*ratioX;
    var ySpeed = 25*ratioY;

    var offsetX = 0;
    var offsetY = 0;
    if(Math.abs(xSpeed) > Math.abs(ySpeed)) {
        offsetX = player.body.width;
    } else {
        offsetY = player.body.height;
    }
    if(forceX < 0) {
        xSpeed *= -1;
        offsetX += 10;
        offsetX *= -1;
    }
    if(forceY < 0) {
        ySpeed *= -1;
        offsetY+= 10;
        offsetY*= -1;
    }

    var projBody = new Body(this.id, src.x+offsetX, src.y+offsetY, 10, 10, 20);
    projBody.xSpeed = xSpeed + player.body.xSpeed;
    projBody.ySpeed = ySpeed + player.body.ySpeed;
    projBody.setGroup('projectile');
    projBody.frictions = 0;
    this.body = projBody;
    this.player_id = player.id;
};

Projectile.prototype = {
    tick: function(elapsedTime) {
        this.body.tick(elapsedTime);
    }
};

module.exports = Projectile;