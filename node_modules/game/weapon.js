var Body = require('physics/body');
var Force = require('physics/force');

var Weapon = function Weapon() {
    this.reloadDelay = 0;
    this.m_currentReload = 0; //Need to be > reloadDelay to fire
};

Weapon.prototype = {
    tick: function(elapsedTime) {
        if(this.m_currentReload <= this.reloadDelay) {
            this.m_currentReload += elapsedTime;
        }
    },

    fire: function(game, src, dest) {
        if(this.m_currentReload >= this.reloadDelay) {
            this.m_currentReload = 0;
            var projBody = new Body(src.x, src.y, 10, 10, 0);
            var forceX = dest.x - src.x;
            var forceY = dest.y - src.y;
            var max = Math.abs(forceX) + Math.abs(forceY);
            var ratioX = Math.abs(forceX)/max;
            var ratioY = Math.abs(forceY)/max;
            console.log(ratioX, ratioY);
            var xSpeed = 15*ratioX;
            var ySpeed = 15*ratioY;
            if(forceX < 0) {
                xSpeed *= -1;
            }
            if(forceY < 0) {
                ySpeed *= -1;
            }
            console.log(xSpeed, ySpeed);
            //projBody.addForce('trajectory', new Force(forceX, forceY));
            projBody.xSpeed = xSpeed;
            projBody.ySpeed = ySpeed;
            projBody.setGroup('projectile');
            projBody.frictions = 0;
            game.addProjectile('bullet'+Date.now(),projBody);
        }
    }
};

module.exports = Weapon;