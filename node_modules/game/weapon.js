var Body = require('physics/body');
var Force = require('physics/force');

var Weapon = function Weapon() {
    this.reloadDelay = 0;
    this.m_currentReload = 0; //Need to be > reloadDelay to fire
};

Weapon.prototype = {
    tick: function(elapsedTime) {
        if(this.m_currentReload <= this.reloadDelay) {
            this.m_currentReload += elapsedTime;
        }
    },

    fire: function(game, src, dest, player) {
        if(this.m_currentReload >= this.reloadDelay) {
            this.m_currentReload = 0;
            var forceX = dest.x - src.x;
            var forceY = dest.y - src.y;
            var max = Math.abs(forceX) + Math.abs(forceY);
            var ratioX = Math.abs(forceX)/max;
            var ratioY = Math.abs(forceY)/max;
            var xSpeed = 25*ratioX;
            var ySpeed = 25*ratioY;
            if(forceX < 0) {
                xSpeed *= -1;
            }
            if(forceY < 0) {
                ySpeed *= -1;
            }
            var projBody = new Body('bullet'+Date.now(), src.x, src.y, 10, 10, 20);
            projBody.xSpeed = xSpeed + player.body.xSpeed;
            projBody.ySpeed = ySpeed + player.body.ySpeed;
            projBody.setGroup('projectile');
            projBody.frictions = 0;
            game.addProjectile(projBody);
        }
    }
};

module.exports = Weapon;